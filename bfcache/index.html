<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><script>window.applyThemeSetting=function(e){const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",o=e||localStorage.getItem("user-color-scheme")||t,r=document.documentElement.getAttribute("data-user-theme");if(o){o!==r&&document.documentElement.setAttribute("data-user-theme",o);const e=document.querySelector("web-lighthouse-viewer article.lh-root");e&&e.classList.toggle("lh-dark","dark"===o)}},window.applyThemeSetting();</script><link href="/css/next.css?v=a9386d79" rel=stylesheet><link as=font crossorigin=anonymous href=/fonts/material-icons/regular.woff2 rel=preload><link as=font crossorigin=anonymous href=/fonts/google-sans/regular/latin.woff2 rel=preload><link as=font crossorigin=anonymous href=/fonts/google-sans/bold/latin.woff2 rel=preload><link href=https://web-dev.imgix.net rel=preconnect><meta content=#fff name=theme-color><title>Back/forward cache</title><meta content="Learn how to optimize your pages for instant loads when using the browser's back and forward buttons. " name=description><link href=https://web.dev/bfcache/ rel=canonical><link href=https://web.dev/i18n/ja/bfcache/ hreflang=ja rel=alternate><link href=https://web.dev/i18n/ko/bfcache/ hreflang=ko rel=alternate><link href=https://web.dev/i18n/ru/bfcache/ hreflang=ru rel=alternate><link href=https://web.dev/bfcache/ hreflang=en rel=alternate><meta content="Back/forward cache" itemprop=name><meta content="Learn how to optimize your pages for instant loads when using the browser's back and forward buttons. " itemprop=description><meta content="https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&fit=max&w=1200&fm=auto" itemprop=image><meta content=en_US property=og:locale><meta content=article property=og:type><meta content=https://web.dev/bfcache/ property=og:url><meta content=web.dev property=og:site_name><meta content="Back/forward cache" property=og:title><meta content="Learn how to optimize your pages for instant loads when using the browser's back and forward buttons. " property=og:description><meta content="https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&fit=max&w=1200&fm=auto" property=og:image><meta content="Back and forward buttons" property=og:image:alt><meta content=performance property=tag><meta content=web-vitals property=tag><meta content=summary_large_image name=twitter:card><meta content="Back/forward cache" name=twitter:title><meta content="Learn how to optimize your pages for instant loads when using the browser's back and forward buttons. " name=twitter:description><meta content="https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&fit=max&w=1200&fm=auto" name=twitter:image><link data-title="web.dev feed" href=/feed.xml rel=alternate type=application/atom+xml><meta content=philipwalton,tunetheweb name=authors><meta content=performance,web-vitals name=tags><link href=/manifest.webmanifest rel=manifest><link rel="shortcut icon" href=/images/favicon.ico><link href=/images/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/images/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link color=#0054ff href=/images/safari-pinned-tab.svg rel=mask-icon><script>function loadScript(e,d){const n=document.createElement("script");if(n.src=e,n.onload=()=>{document.dispatchEvent(new CustomEvent("scriptLoaded",{detail:{url:e}}))},d&&(n.type=d),"module"===d){n.async=!1;const d=document.createElement("link");d.rel="modulepreload",d.href=e,document.head.append(d),window.addEventListener("DOMContentLoaded",(()=>{document.head.append(n)}))}else document.head.append(n)}</script><script>loadScript("/js/app.js?v=fedf5fbe","module");let pageScripts=["/js/content.js"];document.addEventListener("scriptLoaded",(e=>{const t=e.detail.url.split("?")[0],p=pageScripts.indexOf(t);p>-1&&pageScripts.splice(p,1),0===pageScripts.length&&document.dispatchEvent(new CustomEvent("pageScriptsLoaded"))})),loadScript("/js/content.js?v=a119c9fc","module");</script><script>loadScript("https://shared-storage-demo-content-producer.web.app/paa/scripts/private-aggregation-test.js",null);</script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],window.dataLayer.push({"gtm.start":(new Date).getTime(),event:"gtm.js"}),window.dataLayer.push({user_agent:navigator.userAgent}),window.dataLayer.push({"gtm.blocklist":["html","d","jsm","j"]});</script><meta content="Ah3H7DwyoUUsaRQdSySa1hMCS/JFQn/VVmrQODVDnRJGH9mU/uG6G0Uhh+4atnFGAoiEwDq+r9TzCyBi7f7wRw4AAABfeyJvcmlnaW4iOiJodHRwczovL3dlYi5kZXY6NDQzIiwiZmVhdHVyZSI6IlNwZWN1bGF0aW9uUnVsZXNQcmVmZXRjaEZ1dHVyZSIsImV4cGlyeSI6MTY5NDEzMTE5OX0=" http-equiv=origin-trial><script type=speculationrules>{"prerender":[{"source":"document","where":{"and":[{"href_matches":"/*\\?*#*","relative_to":"document"},{"not":{"href_matches":"/patterns/*\\?*#*","relative_to":"document"}}]},"eagerness":"moderate"}]}</script></head><body class=unresolved><web-snackbar-container></web-snackbar-container><a class="skip-link button" data-type=primary href=#main>Skip to content</a><web-header class=site-header role=banner> <div class="cluster gutter-base"><button class="icon-button tooltip color-core-text md:hidden-yes" aria-labelledby=menu-button-toolip data-alignment=right data-open-drawer-button role=tooltip><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z" fill=none /><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg> <span class=tooltip__content id=menu-button-tooltip>Open menu</span></button><a class="site-header__brand brand" href=/> <svg viewbox="0 0 125 24" aria-label=web.dev fill=currentColor height=24 role=img width=125 xmlns=http://www.w3.org/2000/svg><path d="M0.625 19.9489C0.625 18.2638 1.99102 16.8977 3.67614 16.8977H19.9489C21.634 16.8977 23 18.2638 23 19.9489C23 21.634 21.634 23 19.9489 23H3.67614C1.99102 23 0.625 21.634 0.625 19.9489Z" fill=#66CCFF /><path d="M1.51866 1.51866C2.7102 0.327114 4.64208 0.327114 5.83361 1.51866L13.97 9.65503C15.1615 10.8466 15.1615 12.7784 13.97 13.97L5.83361 22.1063C4.64208 23.2979 2.7102 23.2979 1.51866 22.1063C0.327114 20.9148 0.327114 18.9829 1.51866 17.7914L7.13797 12.1721C7.33655 11.9735 7.33655 11.6515 7.13797 11.4529L1.51866 5.83361C0.327114 4.64208 0.327114 2.7102 1.51866 1.51866Z" clip-rule=evenodd fill=#0066FF fill-rule=evenodd /><path d="M11.0422 16.8977L5.83361 22.1063C4.64208 23.2979 2.7102 23.2979 1.51866 22.1063C0.327114 20.9148 0.327114 18.9829 1.51866 17.7914L2.41233 16.8977H11.0422Z" fill=#CC66FF /><path d="M19.9488 23C21.6339 23 23 21.634 23 19.9489C23 18.2638 21.6339 16.8977 19.9488 16.8977C18.2637 16.8977 16.8977 18.2638 16.8977 19.9489C16.8977 21.634 18.2637 23 19.9488 23Z" fill=#0066FF /><path d="M116.6 20.1H114.4L109.6 8.20005H112L115.5 17.4L119 8.20005H121.4L116.6 20.1V20.1ZM99.8 12.8H106.6C106.5 11.2 105.2 9.90005 103.2 9.90005C101.5 9.90005 100.2 11 99.8 12.8V12.8ZM103.4 20.5C99.9 20.5 97.4 17.8 97.4 14.2C97.4 10.6 99.9 7.90005 103.3 7.90005C106.8 7.90005 109.1 10.3 109.1 14.4V14.6H99.8C99.9 16.9 101.6 18.5 103.6 18.5C105 18.5 106.2 17.8 106.9 16.4L108.9 17.4C107.8 19.3 105.8 20.5 103.4 20.5V20.5ZM89.4 20.5C86.3 20.5 83.7 17.7 83.7 14.2C83.7 10.7 86.3 7.90005 89.4 7.90005C91.1 7.90005 92.7 8.70005 93.5 9.90005H93.6L93.5 8.30005V2.80005H95.7V20.1H93.6V18.5H93.5C92.6 19.7 91.1 20.5 89.4 20.5V20.5ZM89.7 18.5C91.9 18.5 93.5 16.8 93.5 14.2C93.5 11.7 91.9 9.90005 89.7 9.90005C87.6 9.90005 85.9 11.7 85.9 14.2C85.9 16.7 87.6 18.5 89.7 18.5ZM82.9 18.6C82.9 19.5 82.2 20.2001 81.2 20.2001C80.3 20.2001 79.5 19.4 79.5 18.6C79.5 17.7 80.3 17 81.2 17C82.2 17 82.9 17.7 82.9 18.6ZM72.4 18.5C74.5 18.5 76.2 16.7 76.2 14.2C76.2 11.7 74.5 9.90005 72.4 9.90005C70.2 9.90005 68.6 11.7 68.6 14.2C68.6 16.7 70.2 18.5 72.4 18.5ZM72.8 20.5C71.1 20.5 69.5 19.7 68.7 18.5H68.6V20.1H66.5V2.80005H68.7V8.30005L68.6 9.90005H68.7C69.5 8.70005 71 7.90005 72.8 7.90005C75.9 7.90005 78.5 10.7 78.5 14.2C78.4 17.7 75.9 20.5 72.8 20.5V20.5ZM55.4 12.8H62.2C62.1 11.2 60.8 9.90005 58.8 9.90005C57.1 9.90005 55.8 11 55.4 12.8V12.8ZM59 20.5C55.5 20.5 53 17.8 53 14.2C53 10.6 55.5 7.90005 58.9 7.90005C62.4 7.90005 64.7 10.3 64.7 14.4V14.6H55.4C55.5 16.9 57.2 18.5 59.2 18.5C60.6 18.5 61.7 17.8 62.5 16.4L64.5 17.4C63.4 19.3 61.4 20.5 59 20.5V20.5ZM52.7 8.30005L48.9 20.2001H46.6L43.6 11.1L40.7 20.2001H38.4L34.5 8.30005H36.8L39.4 17.3L42.3 8.30005H44.6L47.5 17.3L50.1 8.30005H52.7V8.30005Z" clip-rule=evenodd fill-rule=evenodd /></svg> </a></div> <web-navigation-drawer type=standard> <nav aria-label="main navigation" class=site-header__nav data-drawer-container><a data-category="Site-Wide Custom Events" data-label="Tab: About" class=site-header__link href=/about/> About </a><a data-category="Site-Wide Custom Events" data-label="Tab: Blog" class=site-header__link href=/blog/> Blog </a><a data-category="Site-Wide Custom Events" data-label="Tab: Learn" class=site-header__link href=/learn/> Learn </a><a data-category="Site-Wide Custom Events" data-label="Tab: Explore" class=site-header__link href=/explore/> Explore </a><a data-category="Site-Wide Custom Events" data-label="Tab: Patterns" class=site-header__link href=/patterns/> Patterns </a><a data-category="Site-Wide Custom Events" data-label="Tab: Case Studies" class=site-header__link href=/tags/case-study/> Case studies </a><button class="icon-button tooltip color-core-text md:hidden-yes" data-drawer-close-button><svg viewbox="0 0 24 24" aria-label=close class=icon height=24 role=img width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z" fill=none /><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> <span class=tooltip__content>Close</span></button></nav> </web-navigation-drawer> <div class="site-header__actions cluster"><div class=site-header__search><web-search i18n='{"search":{"en":"Search"},"open_search":{"en":"Open search"},"all_articles":{"en":"All articles"},"close_search":{"en":"Close search"}}' results-id=search-main-results></web-search><web-search-results id=search-main-results></web-search-results></div></div> </web-header><main id=main><div class="banner bg-state-info-bg color-core-text" role=banner><div class="banner__content flow">Thanks for tuning in to Google I/O. <a href="https://io.google/2023/program/?q=web-topic,web/&utm_source=web&utm_medium=embedded_marketing&utm_campaign=hpp_ondemand_banner&utm_content=">Watch the Chrome content on-demand.</a></div></div><img alt="Back and forward buttons" src="https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format" srcset="https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/admin/Qoeb8x3a11BdGgRzYJbY.png?auto=format&w=1600 1600w" class=hero-image fetchpriority=high height=480 sizes=100vw width=1600><div class="post wrapper" data-flush><div class="sidebar region flex-align-start flex-dir-rev flex-wrap-no"><nav aria-label="On this page" class="course__toc toc over-scroll hidden-yes lg:hidden-no" data-type=side><div class="course-toc__heading font-google-sans weight-medium">On this page</div><web-scroll-spy> <div class="toc__wrapper flow-recursive"><ul class=toc__list><li class=toc__listitem><a class=toc__anchor href=#browser-compatibility>Browser compatibility</a></li><li class=toc__listitem><a class=toc__anchor href=#bfcache-basics>bfcache basics</a><ul class=toc__list><li class=toc__listitem><a class=toc__anchor href=#how-the-cache-works>How the "cache" works</a></li><li class=toc__listitem><a class=toc__anchor href=#apis-to-observe-bfcache>APIs to observe bfcache</a></li></ul></li><li class=toc__listitem><a class=toc__anchor href=#optimize-your-pages-for-bfcache>Optimize your pages for bfcache</a><ul class=toc__list><li class=toc__listitem><a class=toc__anchor href=#never-use-the-unload-event>Never use the unload event</a></li><li class=toc__listitem><a class=toc__anchor href=#minimize-use-of-cache-control-no-store>Minimize use of Cache-Control: no-store</a></li><li class=toc__listitem><a class=toc__anchor href=#update-stale-or-sensitive-data-after-bfcache-restore>Update stale or sensitive data after bfcache restore</a></li><li class=toc__listitem><a class=toc__anchor href=#avoid-windowopener-references>Avoid window.opener references</a></li><li class=toc__listitem><a class=toc__anchor href=#always-close-open-connections-before-the-user-navigates-away>Always close open connections before the user navigates away</a></li><li class=toc__listitem><a class=toc__anchor href=#test-to-ensure-your-pages-are-cacheable>Test to ensure your pages are cacheable</a></li></ul></li><li class=toc__listitem><a class=toc__anchor href=#how-bfcache-affects-analytics-and-performance-measurement>How bfcache affects analytics and performance measurement</a><ul class=toc__list><li class=toc__listitem><a class=toc__anchor href=#measuring-your-bfcache-hit-ratio>Measuring your bfcache hit ratio</a></li><li class=toc__listitem><a class=toc__anchor href=#performance-measurement>Performance measurement</a></li><li class=toc__listitem><a class=toc__anchor href=#impact-on-core-web-vitals>Impact on Core Web Vitals</a></li></ul></li><li class=toc__listitem><a class=toc__anchor href=#additional-resources>Additional Resources</a></li></ul></div> </web-scroll-spy></nav><article class="prose legacy-rollout"><header class="flow gap-bottom-size-3"><nav aria-label=breadcrumbs class=breadcrumbs><ul class=breadcrumbs__list role=list><li><a data-label="post, home breadcrumb" class=gc-analytics-event data-action=click data-category=web.dev href=/> Home </a></li><li><a data-label="post, path breadcrumb" class=gc-analytics-event data-action=click data-category=web.dev href=/blog> All articles </a></li></ul></nav><h1>Back/forward cache</h1><p class="color-mid-text flow-space-base">Optimize your pages for instant loads when using the browser's back and forward buttons.</p><div class="flow-space-size-1 color-mid-text text-size-0"><time>Nov 10, 2020</time> — Updated <time>May 25, 2023</time></div><div class=flow><span class=post-signpost__title> Available in: <span> <a class=post-signpost__link href=/i18n/en/bfcache/ lang=en translate=no>English</a>, </span> <span> <a class=post-signpost__link href=/i18n/ru/bfcache/ lang=ru translate=no>Русский</a>, </span> <span> <a class=post-signpost__link href=/i18n/ja/bfcache/ lang=ja translate=no>日本語</a>, and </span> <span> <a class=post-signpost__link href=/i18n/ko/bfcache/ lang=ko translate=no>한국어</a> </span> </span></div><div class=flow><div class="flow post-signpost"></div></div><div class="cluster flow-space-size-2"><div class=author><a class=avatar href=/authors/philipwalton/> <img alt="Philip Walton" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" src="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?auto=format&fit=crop&h=64&w=64" srcset="https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/admin/ovBM8MF9rYDxVVHUVlcG.jpg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x" decoding=async height=64 loading=lazy width=64> </a><div class=flow><cite class=author__name> <a href=/authors/philipwalton/>Philip Walton</a> </cite><div class="author__links cluster"><a href=https://twitter.com/philwalton>Twitter</a><a href=https://github.com/philipwalton>GitHub</a><a href=https://philipwalton.com>Homepage</a></div></div></div><div class=author><a class=avatar href=/authors/tunetheweb/> <img alt="Barry Pollard" sizes="(min-width: 64px) 64px, calc(100vw - 48px)" src="https://web-dev.imgix.net/image/W3z1f5ZkBJSgL1V1IfloTIctbIF3/FzCdsVVLfgdqxfgs6BDc.jpeg?auto=format&fit=crop&h=64&w=64" srcset="https://web-dev.imgix.net/image/W3z1f5ZkBJSgL1V1IfloTIctbIF3/FzCdsVVLfgdqxfgs6BDc.jpeg?fit=crop&h=64&w=64&auto=format&dpr=1&q=75 1x,     https://web-dev.imgix.net/image/W3z1f5ZkBJSgL1V1IfloTIctbIF3/FzCdsVVLfgdqxfgs6BDc.jpeg?fit=crop&h=64&w=64&auto=format&dpr=2&q=50 2x,     https://web-dev.imgix.net/image/W3z1f5ZkBJSgL1V1IfloTIctbIF3/FzCdsVVLfgdqxfgs6BDc.jpeg?fit=crop&h=64&w=64&auto=format&dpr=3&q=35 3x,     https://web-dev.imgix.net/image/W3z1f5ZkBJSgL1V1IfloTIctbIF3/FzCdsVVLfgdqxfgs6BDc.jpeg?fit=crop&h=64&w=64&auto=format&dpr=4&q=23 4x,     https://web-dev.imgix.net/image/W3z1f5ZkBJSgL1V1IfloTIctbIF3/FzCdsVVLfgdqxfgs6BDc.jpeg?fit=crop&h=64&w=64&auto=format&dpr=5&q=20 5x" decoding=async height=64 loading=lazy width=64> </a><div class=flow><cite class=author__name> <a href=/authors/tunetheweb/>Barry Pollard</a> </cite><div class="author__links cluster"><a href=https://twitter.com/tunetheweb>Twitter</a><a href=https://github.com/tunetheweb>GitHub</a><a href=https://www.tunetheweb.com>Homepage</a></div></div></div></div></header><div class="lg:hidden-yes flow-space-size-1"><details aria-label="On this page" data-type=inner role=navigation><summary>On this page</summary> <div class=toc><ul class=toc__list><li class=toc__listitem><a class=toc__anchor href=#browser-compatibility>Browser compatibility</a></li><li class=toc__listitem><a class=toc__anchor href=#bfcache-basics>bfcache basics</a><ul class=toc__list><li class=toc__listitem><a class=toc__anchor href=#how-the-cache-works>How the "cache" works</a></li><li class=toc__listitem><a class=toc__anchor href=#apis-to-observe-bfcache>APIs to observe bfcache</a></li></ul></li><li class=toc__listitem><a class=toc__anchor href=#optimize-your-pages-for-bfcache>Optimize your pages for bfcache</a><ul class=toc__list><li class=toc__listitem><a class=toc__anchor href=#never-use-the-unload-event>Never use the unload event</a></li><li class=toc__listitem><a class=toc__anchor href=#minimize-use-of-cache-control-no-store>Minimize use of Cache-Control: no-store</a></li><li class=toc__listitem><a class=toc__anchor href=#update-stale-or-sensitive-data-after-bfcache-restore>Update stale or sensitive data after bfcache restore</a></li><li class=toc__listitem><a class=toc__anchor href=#avoid-windowopener-references>Avoid window.opener references</a></li><li class=toc__listitem><a class=toc__anchor href=#always-close-open-connections-before-the-user-navigates-away>Always close open connections before the user navigates away</a></li><li class=toc__listitem><a class=toc__anchor href=#test-to-ensure-your-pages-are-cacheable>Test to ensure your pages are cacheable</a></li></ul></li><li class=toc__listitem><a class=toc__anchor href=#how-bfcache-affects-analytics-and-performance-measurement>How bfcache affects analytics and performance measurement</a><ul class=toc__list><li class=toc__listitem><a class=toc__anchor href=#measuring-your-bfcache-hit-ratio>Measuring your bfcache hit ratio</a></li><li class=toc__listitem><a class=toc__anchor href=#performance-measurement>Performance measurement</a></li><li class=toc__listitem><a class=toc__anchor href=#impact-on-core-web-vitals>Impact on Core Web Vitals</a></li></ul></li><li class=toc__listitem><a class=toc__anchor href=#additional-resources>Additional Resources</a></li></ul></div></details></div><p>Back/forward cache (or bfcache) is a browser optimization that enables instant back and forward navigation. It significantly improves the browsing experience for users—especially those with slower networks or devices.</p><p>As web developers, it's critical to understand how to <a href=#optimize-your-pages-for-bfcache>optimize your pages for bfcache</a> across all browsers, so your users can reap the benefits.</p><h2 id=browser-compatibility>Browser compatibility <a class=headline-link href=#browser-compatibility>#</a></h2><p>bfcache has been supported in both <a href=https://developer.mozilla.org/docs/Mozilla/Firefox/Releases/1.5/Using_Firefox_1.5_caching rel=noopener>Firefox</a> and <a href=https://webkit.org/blog/427/webkit-page-cache-i-the-basics/ rel=noopener>Safari</a> for many years, across desktop and mobile.</p><p>Starting in version 86, Chrome enabled bfcache for <a href=/same-site-same-origin/>cross-site</a> navigations on Android for a small percentage of users. In subsequent releases, additional support slowly rolled out. Since version 96, bfcache is enabled for all Chrome users across desktop and mobile.</p><h2 id=bfcache-basics>bfcache basics <a class=headline-link href=#bfcache-basics>#</a></h2><p>bfcache is an in-memory cache that stores a complete snapshot of a page (including the JavaScript heap) as the user is navigating away. With the entire page in memory, the browser can quickly and easily restore it if the user decides to return.</p><p>How many times have you visited a website and clicked a link to go to another page, only to realize it's not what you wanted and click the back button? In that moment, bfcache can make a big difference in how fast the previous page loads:</p><div class=table-wrapper><table data-alignment=top><tr><td width=30%><strong><em>Without</em> bfcache enabled</strong></td><td>A new request is initiated to load the previous page, and, depending on how well that page has been <a href=/reliable/#the-options-in-your-caching-toolbox> optimized</a> for repeat visits, the browser might have to re-download, re-parse, and re-execute some (or all) of resources it just downloaded.</td></tr><tr><td><strong><em>With</em> bfcache enabled</strong></td><td>Loading the previous page is <em>essentially instant</em>, because the entire page can be restored from memory, without having to go to the network at all</td></tr></table></div><p>Check out this video of bfcache in action to understand the speed up it can bring to navigations:</p><div class=youtube><lite-youtube videoid=cuPsdRckkF0> </lite-youtube></div><p>In the video above, the example with bfcache is quite a bit faster than the example without it.</p><p>bfcache not only speeds up navigation, it also reduces data usage, since resources do not have to be downloaded again.</p><p>Chrome usage data shows that 1 in 10 navigations on desktop and 1 in 5 on mobile are either back or forward. With bfcache enabled, browsers could eliminate the data transfer and time spent loading for billions of web pages every single day!</p><h3 id=how-the-cache-works>How the "cache" works <a class=headline-link href=#how-the-cache-works>#</a></h3><p>The "cache" used by bfcache is different from the <a href=/http-cache/>HTTP cache</a> (which is also useful in speeding up repeat navigations). The bfcache is a snapshot of the entire page in memory (including the JavaScript heap), whereas the HTTP cache contains only the responses for previously made requests. Since it's quite rare that all requests required to load a page can be fulfilled from the HTTP cache, repeat visits using bfcache restores are always faster than even the most well-optimized non-bfcache navigations.</p><p>Creating a snapshot of a page in memory, however, involves some complexity in terms of how best to preserve in-progress code. For example, how do you handle <code>setTimeout()</code> calls where the timeout is reached while the page is in the bfcache?</p><p>The answer is that browsers pause running any pending timers or unresolved promises—essentially all pending tasks in the <a href=https://html.spec.whatwg.org/multipage/webappapis.html#task-queue rel=noopener>JavaScript task queues</a>—and resume processing tasks when (or if) the page is restored from the bfcache.</p><p>In some cases this is fairly low-risk (for example, timeouts or promises), but in other cases it might lead to very confusing or unexpected behavior. For example, if the browser pauses a task that's required as part of an <a href=https://developer.mozilla.org/docs/Web/API/IDBTransaction rel=noopener>IndexedDB transaction</a>, it can affect other open tabs in the same origin (since the same IndexedDB databases can be accessed by multiple tabs simultaneously). As a result, browsers will generally not attempt to cache pages in the middle of an IndexedDB transaction or using APIs that might affect other pages.</p><p>For more details on how various API usage affects a page's bfcache eligibility, see <a href=#optimize-your-pages-for-bfcache>Optimize your pages for bfcache</a> below.</p><h3 id=apis-to-observe-bfcache>APIs to observe bfcache <a class=headline-link href=#apis-to-observe-bfcache>#</a></h3><p>While bfcache is an optimization that browsers do automatically, it's still important for developers to know when it's happening so they can <a href=#optimize-your-pages-for-bfcache>optimize their pages for it</a> and <a href=#implications-for-analytics-and-performance-measurement>adjust any metrics or performance measurement</a> accordingly.</p><p>The primary events used to observe bfcache are the <a href=https://developer.mozilla.org/docs/Web/API/PageTransitionEvent rel=noopener>page transition events</a>—<code>pageshow</code> and <code>pagehide</code>—which have been around as long as bfcache has and are supported in pretty much <a href=https://caniuse.com/page-transition-events rel=noopener>all browsers in use today</a>.</p><p>The newer <a href=https://developer.chrome.com/blog/page-lifecycle-api/ rel=noopener>Page Lifecycle</a> events—<code>freeze</code> and <code>resume</code>—are also dispatched when pages go in or out of the bfcache, as well as in some other situations. For example when a background tab gets frozen to minimize CPU usage. Note, the Page Lifecycle events are currently only supported in Chromium-based browsers.</p><h4 id=observe-when-a-page-is-restored-from-bfcache>Observe when a page is restored from bfcache <a class=headline-link href=#observe-when-a-page-is-restored-from-bfcache>#</a></h4><p>The <code>pageshow</code> event fires right after the <code>load</code> event when the page is initially loading and any time the page is restored from bfcache. The <code>pageshow</code> event has a <a href=https://developer.mozilla.org/docs/Web/API/PageTransitionEvent/persisted rel=noopener><code>persisted</code></a> property which will be <code>true</code> if the page was restored from bfcache (and <code>false</code> if not). You can use the <code>persisted</code> property to distinguish regular page loads from bfcache restores. For example:</p><web-copy-code><pre class=language-js><code class=language-js>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pageshow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>persisted<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This page was restored from the bfcache.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This page was loaded normally.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code><p>In browsers that support the Page Lifecycle API, the <code>resume</code> event will also fire when pages are restored from bfcache (immediately before the <code>pageshow</code> event), though it will also fire when a user revisits a frozen background tab. If you want to restore a page's state after it's frozen (which includes pages in the bfcache), you can use the <code>resume</code> event, but if you want to measure your site's bfcache hit rate, you'd need to use the <code>pageshow</code> event. In some cases, you might need to use both.</p><aside class="aside flow bg-state-info-bg color-state-info-text"><div class=flow>See <a href=#how-bfcache-affects-analytics-and-performance-measurement>Implications for performance and analytics</a> for more details on bfcache measurement best practices.</div></aside><h4 id=observe-when-a-page-is-entering-bfcache>Observe when a page is entering bfcache <a class=headline-link href=#observe-when-a-page-is-entering-bfcache>#</a></h4><p>The <code>pagehide</code> event is the counterpart to the <code>pageshow</code> event. The <code>pageshow</code> event fires when a page is either loaded normally or restored from the bfcache. The <code>pagehide</code> event fires when the page is either unloaded normally or when the browser attempts to put it into the bfcache.</p><p>The <code>pagehide</code> event also has a <code>persisted</code> property, and if it's <code>false</code> then you can be confident a page is not about to enter the bfcache. However, if the <code>persisted</code> property is <code>true</code>, it doesn't guarantee that a page will be cached. It means that the browser <em>intends</em> to cache the page, but there may be factors that make it impossible to cache.</p><web-copy-code><pre class=language-js><code class=language-js>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pagehide'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>persisted<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This page *might* be entering the bfcache.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This page will unload normally and be discarded.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code><p>Similarly, the <code>freeze</code> event will fire immediately after the <code>pagehide</code> event (if the event's <code>persisted</code> property is <code>true</code>), but again that only means the browser <em>intends</em> to cache the page. It may still have to discard it for a number of reasons explained below.</p><h2 id=optimize-your-pages-for-bfcache>Optimize your pages for bfcache <a class=headline-link href=#optimize-your-pages-for-bfcache>#</a></h2><p>Not all pages get stored in bfcache, and even when a page does get stored there, it won't stay there indefinitely. It's critical that developers understand what makes pages eligible (and ineligible) for bfcache to maximize their cache-hit rates.</p><p>The following sections outline the best practices to make it as likely as possible that the browser can cache your pages.</p><h3 id=never-use-the-unload-event>Never use the <code>unload</code> event <a class=headline-link href=#never-use-the-unload-event>#</a></h3><p>The most important way to optimize for bfcache in all browsers is to never use the <code>unload</code> event. Ever!</p><p>The <code>unload</code> event is problematic for browsers because it predates bfcache and many pages on the internet operate under the (reasonable) assumption that a page will not continue to exist after the <code>unload</code> event has fired. This presents a challenge because many of those pages were <em>also</em> built with the assumption that the <code>unload</code> event would fire any time a user is navigating away, which is no longer true (and <a href=https://developer.chrome.com/blog/page-lifecycle-api/#the-unload-event rel=noopener>hasn't been true for a long time</a>).</p><p>So browsers are faced with a dilemma, they have to choose between something that can improve the user experience—but might also risk breaking the page.</p><p>On desktop, Chrome and Firefox have chosen to make pages ineligible for bfcache if they add an <code>unload</code> listener, which is less risky but also disqualifies <em>a lot</em> of pages. Safari will attempt to cache some pages with an <code>unload</code> event listener, but to reduce potential breakage it will not run the <code>unload</code> event when a user is navigating away, which makes the event very unreliable.</p><p>On mobile, Chrome and Safari will attempt to cache pages with an <code>unload</code> event listener since the risk of breakage is lower due to the fact that the <code>unload</code> event has always been extremely unreliable on mobile. Firefox treats pages that use <code>unload</code> as ineligible for the bfcache, except on iOS, which requires all browsers to use the WebKit rendering engine, and so it behaves like Safari.</p><p>Instead of using the <code>unload</code> event, use the <code>pagehide</code> event. The <code>pagehide</code> event fires in all cases where the <code>unload</code> event currently fires, and it <em>also</em> fires when a page is put in the bfcache.</p><p>In fact, <a href=https://developer.chrome.com/docs/lighthouse/ rel=noopener>Lighthouse</a> has a <a href=https://github.com/GoogleChrome/lighthouse/pull/11085 rel=noopener><code>no-unload-listeners</code> audit</a>, which will warn developers if any JavaScript on their pages (including that from third-party libraries) adds an <code>unload</code> event listener.</p><aside class="aside flow bg-state-warn-bg color-state-warn-text"><p class=cluster><span class="aside__icon box-block color-state-warn-text"><svg aria-label="Warning sign" viewbox="0 0 24 24" fill=currentColor height=24 role=img width=24 xmlns=http://www.w3.org/2000/svg><path d="M23 21L12 2 1 21h22zm-12-3v-2h2v2h-2zm0-4h2v-4h-2v4z" clip-rule=evenodd fill-rule=evenodd /></svg></span><strong>Warning</strong></p><div class=flow>Never add an <code>unload</code> event listener! Use the <code>pagehide</code> event instead. Adding an <code>unload</code> event listener will make your site slower in Firefox, and the code won't even run most of the time in Chrome and Safari.</div></aside><h4 id=only-add-beforeunload-listeners-conditionally>Only add <code>beforeunload</code> listeners conditionally <a class=headline-link href=#only-add-beforeunload-listeners-conditionally>#</a></h4><p>The <code>beforeunload</code> event will not make your pages ineligible for bfcache in Chrome or Safari, but it will make them ineligible in Firefox, so avoid using it unless absolutely necessary.</p><p>Unlike the <code>unload</code> event, however, there are legitimate uses for <code>beforeunload</code>. For example, when you want to warn the user that they have unsaved changes they'll lose if they leave the page. In this case, it's recommended that you only add <code>beforeunload</code> listeners when a user has unsaved changes and then remove them immediately after the unsaved changes are saved.</p><figure class="compare flow" data-size=full data-type=worse><p class=compare__label>Don't</p><web-copy-code><pre class=language-js><code class=language-js>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pageHasUnsavedChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> event<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> <span class="token string">'Are you sure you want to exit?'</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code><figcaption class=compare__caption><p>The code above adds a <code>beforeunload</code> listener unconditionally.</p></figcaption></figure><figure class="compare flow" data-size=full data-type=better><p class=compare__label>Do</p><web-copy-code><pre class=language-js><code class=language-js><span class="token keyword">function</span> <span class="token function">beforeUnloadListener</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> event<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> <span class="token string">'Are you sure you want to exit?'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// A function that invokes a callback when the page has unsaved changes.</span><br><span class="token function">onPageHasUnsavedChanges</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> beforeUnloadListener<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// A function that invokes a callback when the page's unsaved changes are resolved.</span><br><span class="token function">onAllChangesSaved</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> beforeUnloadListener<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code><figcaption class=compare__caption><p>The code above only adds the <code>beforeunload</code> listener when it's needed (and removes it when it's not).</p></figcaption></figure><h3 id=minimize-use-of-cache-control-no-store>Minimize use of <code>Cache-Control: no-store</code> <a class=headline-link href=#minimize-use-of-cache-control-no-store>#</a></h3><p><code>Cache-Control: no-store</code> is an HTTP header web servers can set on responses that instructs the browser not to store the response in any HTTP cache. This should be used for resources containing sensitive user information, for example pages behind a login.</p><p>Though bfcache is not an HTTP cache, historically, when <code>Cache-Control: no-store</code> is set on the page resource itself (as opposed to any subresource), browsers have chosen not to store the page in bfcache. There is <a href=https://github.com/fergald/explainer-bfcache-ccns/blob/main/README.md rel=noopener>work currently underway to change this behavior for Chrome</a> in a privacy-preserving manner, but at present any pages using <code>Cache-Control: no-store</code> will not be eligible for bfcache.</p><p>Since <code>Cache-Control: no-store</code> restricts a page's eligibility for bfcache, it should only be set on pages that contain sensitive information where caching of any sort is never appropriate.</p><p>For pages that wish to always serve up-to-date content—and that content does not contain sensitive information—use <code>Cache-Control: no-cache</code> or <code>Cache-Control: max-age=0</code>. These directives instruct the browser to revalidate the content before serving it, and they do not affect a page's bfcache eligibility.</p><p>Note that when a page is restored from bfcache, it is restored from memory, not from the HTTP cache. As a result, directives like <code>Cache-Control: no-cache</code> or <code>Cache-Control: max-age=0</code> are not taken into account, and no revalidation occurs before the content is displayed to the user.</p><p>This is still likely a better user experience, however, as bfcache restores are instant and—since pages do not stay in the bfcache for very long—it's unlikely that the content is out of date. However, if your content does change minute-by-minute, you can fetch any updates using the <code>pageshow</code> event, as outlined in the next section.</p><h3 id=update-stale-or-sensitive-data-after-bfcache-restore>Update stale or sensitive data after bfcache restore <a class=headline-link href=#update-stale-or-sensitive-data-after-bfcache-restore>#</a></h3><p>If your site keeps user state—especially any sensitive user information—that data needs to be updated or cleared after a page is restored from bfcache.</p><p>For example, if a user navigates to a checkout page and then updates their shopping cart, a back navigation could potentially expose out-of-date information if a stale page is restored from bfcache.</p><p>Another, more critical example is if a user signs out of a site on a public computer and the next user clicks the back button. This could potentially expose private data that the user assumed was cleared when they logged out.</p><p>To avoid situations like this, it's good to always update the page after a <code>pageshow</code> event if <code>event.persisted</code> is <code>true</code>.</p><p>The following code checks for the presence of a site-specific cookie in the <code>pageshow</code> event and reloads if the cookie is not found:</p><web-copy-code><pre class=language-js><code class=language-js>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pageshow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>persisted <span class="token operator">&&</span> <span class="token operator">!</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">my-cookie</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Force a reload if the user has logged out.</span><br>    location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code><h3 id=avoid-windowopener-references>Avoid <code>window.opener</code> references <a class=headline-link href=#avoid-windowopener-references>#</a></h3><p>In some browsers (including Chromium-based browsers) if a page was opened using <a href=https://developer.mozilla.org/docs/Web/API/Window/open rel=noopener><code>window.open()</code></a> or (in <a href=https://crbug.com/898942 rel=noopener>Chromium-based browsers prior to version 88</a>) from a link with <a href=https://developer.mozilla.org/docs/Web/HTML/Element/a#target rel=noopener><code>target=_blank</code></a>—without specifying <a href=https://developer.mozilla.org/docs/Web/HTML/Link_types/noopener rel=noopener><code>rel="noopener"</code></a>—then the opening page will have a reference to the window object of the opened page.</p><p>In addition to <a href=https://mathiasbynens.github.io/rel-noopener/ rel=noopener>being a security risk</a>, a page with a non-null <a href=https://developer.mozilla.org/docs/Web/API/Window/opener rel=noopener><code>window.opener</code></a> reference cannot safely be put into the bfcache because that could break any pages attempting to access it.</p><p>As a result, it's best to avoid creating <code>window.opener</code> references. You can do this by using <code>rel="noopener"</code> whenever possible. If your site requires opening a window and controlling it through <a href=https://developer.mozilla.org/docs/Web/API/Window/postMessage rel=noopener><code>window.postMessage()</code></a> or directly referencing the window object, neither the opened window nor the opener will be eligible for the bfcache.</p><h3 id=always-close-open-connections-before-the-user-navigates-away>Always close open connections before the user navigates away <a class=headline-link href=#always-close-open-connections-before-the-user-navigates-away>#</a></h3><p>As mentioned above, when a page is put into the bfcache all scheduled JavaScript tasks are paused and then resumed when the page is taken out of the cache.</p><p>If these scheduled JavaScript tasks are only accessing DOM APIs—or other APIs isolated to just the current page—then pausing these tasks while the page is not visible to the user is not going to cause any problems.</p><p>However, if these tasks are connected to APIs that are also accessible from other pages in the same origin (for example: IndexedDB, Web Locks, WebSockets, etc.) this can be problematic because pausing these tasks may prevent code in other tabs from running.</p><p>As a result, some browsers will not attempt to put a page in bfcache in the following scenarios:</p><ul><li>Pages with an open <a href=https://developer.mozilla.org/docs/Web/API/IDBOpenDBRequest rel=noopener>IndexedDB connection</a></li><li>Pages with in-progress <a href=https://developer.mozilla.org/docs/Web/API/Fetch_API rel=noopener>fetch()</a> or <a href=https://developer.mozilla.org/docs/Web/API/XMLHttpRequest rel=noopener>XMLHttpRequest</a></li><li>Pages with an open <a href=https://developer.mozilla.org/docs/Web/API/WebSocket rel=noopener>WebSocket</a> or <a href=https://developer.mozilla.org/docs/Web/API/WebRTC_API rel=noopener>WebRTC</a> connection</li></ul><p>If your page is using any of these APIs, it's best to always close connections and remove or disconnect observers during the <code>pagehide</code> or <code>freeze</code> event. That will allow the browser to safely cache the page without the risk of it affecting other open tabs.</p><p>Then, if the page is restored from the bfcache, you can re-open or re-connect to those APIs (in the <code>pageshow</code> or <code>resume</code> event).</p><p>The following example shows how to ensure your pages are eligible for bfcache when using IndexedDB by closing an open connection in the <code>pagehide</code> event listener:</p><web-copy-code><pre class=language-js><code class=language-js><span class="token keyword">let</span> dbPromise<span class="token punctuation">;</span><br><span class="token keyword">function</span> <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dbPromise<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    dbPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> req <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'my-db'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      req<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> req<span class="token punctuation">.</span>result<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">'keyval'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      req<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      req<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> dbPromise<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Close the connection to the database when the user is leaving.</span><br>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pagehide'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>dbPromise<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    dbPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">db</span> <span class="token operator">=></span> db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    dbPromise <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Open the connection when the page is loaded or restored from bfcache.</span><br>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pageshow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">openDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code><h3 id=test-to-ensure-your-pages-are-cacheable>Test to ensure your pages are cacheable <a class=headline-link href=#test-to-ensure-your-pages-are-cacheable>#</a></h3><p>Chrome DevTools can help you test your pages to ensure they're optimized for bfcache, and identify any issues that may be preventing them from being eligible.</p><p>To test a particular page, navigate to it in Chrome and then in DevTools go to <strong>Application</strong> > <strong>Back-forward Cache</strong>. Next click the <strong>Run Test</strong> button and DevTools will attempt to navigate away and back to determine whether the page could be restored from bfcache.</p><img alt="Back-forward cache panel in DevTools" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/QafTzULUNflaSh77zBgT.png?auto=format&w=1600 1600w" decoding=async height=313 loading=lazy width=800><aside class="aside flow bg-state-info-bg color-state-info-text"><div class=flow>The Back/forward Cache feature in DevTools is currently in active development. We strongly encourage developers to test their pages in Chrome Canary to ensure they're running the latest version of DevTools and getting the most up-to-date bfcache recommendations.</div></aside><p>If successful, the panel will report "Restored from back-forward cache":</p><img alt="DevTools reporting a page was successfully restored from bfcache" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/vPwN0z95ZBTiwZIpdZT4.png?auto=format&w=1600 1600w" decoding=async height=313 loading=lazy width=800><p>If unsuccessful, the panel will indicate the page was not restored and list the reason why. If the reason is something you as a developer can address, that will also be indicated:</p><img alt="DevTools reporting failure to restore a page from bfcache" sizes="(min-width: 800px) 800px, calc(100vw - 48px)" src="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format" srcset="https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=200 200w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=228 228w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=260 260w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=296 296w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=338 338w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=385 385w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=439 439w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=500 500w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=571 571w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=650 650w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=741 741w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=845 845w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=964 964w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=1098 1098w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=1252 1252w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=1428 1428w,     https://web-dev.imgix.net/image/eqprBhZUGfb8WYnumQ9ljAxRrA72/ji3ew4DoP6joKdJvtGwa.png?auto=format&w=1600 1600w" decoding=async height=313 loading=lazy width=800><p>In the screenshot above, the use of an <code>unload</code> event listener is <a href=/bfcache/#never-use-the-unload-event>preventing</a> the page from being eligible for bfcache. You can fix that by switching from <code>unload</code> to using <code>pagehide</code> instead:</p><figure class="compare flow" data-size=full data-type=worse><p class=compare__label>Don't</p><web-copy-code><pre class=language-js><code class=language-js>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unload'</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code></figure><figure class="compare flow" data-size=full data-type=better><p class=compare__label>Do</p><web-copy-code><pre class=language-js><code class=language-js>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pagehide'</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code></figure><p>Lighthouse 10.0 also <a href=https://developer.chrome.com/blog/lighthouse-10-0/#bfcache rel=noopener>added a bfcache audit</a>, which performs a similar test to the one DevTools does, and also provides reasons why the page is ineligible if the audit fails. Take a look at the <a href=https://developer.chrome.com/docs/lighthouse/performance/bf-cache/ rel=noopener>bfcache audit's docs</a> for more information.</p><h2 id=how-bfcache-affects-analytics-and-performance-measurement>How bfcache affects analytics and performance measurement <a class=headline-link href=#how-bfcache-affects-analytics-and-performance-measurement>#</a></h2><p>If you track visits to your site with an analytics tool, you will likely notice a decrease in the total number of pageviews reported as Chrome continues to enable bfcache for more users.</p><p>In fact, you're likely <em>already</em> underreporting pageviews from other browsers that implement bfcache since most of the popular analytics libraries do not track bfcache restores as new pageviews.</p><p>If you don't want your pageview counts to go down due to Chrome enabling bfcache, you can report bfcache restores as pageviews (recommended) by listening to the <code>pageshow</code> event and checking the <code>persisted</code> property.</p><p>The following example shows how to do this with Google Analytics; the logic should be similar for other analytics tools:</p><web-copy-code><pre class=language-js><code class=language-js><span class="token comment">// Send a pageview when the page is first loaded.</span><br><span class="token function">gtag</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token string">'page_view'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pageshow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Send another pageview if the page is restored from bfcache.</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>persisted<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">gtag</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token string">'page_view'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code><h3 id=measuring-your-bfcache-hit-ratio>Measuring your bfcache hit ratio <a class=headline-link href=#measuring-your-bfcache-hit-ratio>#</a></h3><p>You may also wish to track whether the bfcache was used, to help identify pages that are not utilizing the bfcache. For example, with an event:</p><web-copy-code><pre class=language-js><code class=language-js>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pageshow'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// You can measure bfcache hit rate by tracking all bfcache restores and</span><br>  <span class="token comment">// other back/forward navigations via a separate event.</span><br>  <span class="token keyword">const</span> navigationType <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'navigation'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>persisted <span class="token operator">||</span> navigationType <span class="token operator">==</span> <span class="token string">'back_forward'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">gtag</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token string">'back_forward_navigation'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      <span class="token string-property property">'isBFCache'</span><span class="token operator">:</span> event<span class="token punctuation">.</span>persisted<span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> </web-copy-code><p>It is important to realize that there are a number of scenarios, outside of the site owners control, when a Back/Forward navigation will not use the bfcache, including:</p><ul><li>when the user quits the browser and starts it again</li><li>when the user duplicates a tab</li><li>when the user closes a tab and uncloses it</li></ul><p>Even without those exclusions the bfcache will be discarded after a period to conserve memory.</p><p>So, website owners should not be expecting a 100% bfcache hit ratio for all <code>back_forward</code> navigations. However, measuring their ratio can be useful to identify pages where the page itself is preventing bfcache usage for a high proportion of back and forward navigations.</p><p>The Chrome team is working on a <a href=https://github.com/rubberyuzu/bfcache-not-retored-reason/blob/main/NotRestoredReason.md rel=noopener><code>NotRestoredReasons</code> API</a> to help expose the reasons why the bfcache was not used to help developers understand the reasoning the cache was not used and if this is something they can work on to improve for their sites.</p><h3 id=performance-measurement>Performance measurement <a class=headline-link href=#performance-measurement>#</a></h3><p>bfcache can also negatively affect performance metrics collected <a href=/user-centric-performance-metrics/#in-the-field>in the field</a>, specifically metrics that measure page load times.</p><p>Since bfcache navigations restore an existing page rather than initiate a new page load, the total number of page loads collected will decrease when bfcache is enabled. What's critical, though, is that the page loads being replaced by bfcache restores would likely have been some of the fastest page loads in your dataset. This is because back and forward navigations, by definition, are repeat visits, and repeat page loads are generally faster than page loads from first time visitors (due to <a href=/http-cache/>HTTP caching</a>, as mentioned earlier).</p><p>The result is fewer fast page loads in your dataset, which will likely skew the distribution slower—despite the fact that the performance experienced by the user has probably improved!</p><p>There are a few ways to deal with this issue. One is to annotate all page load metrics with their respective <a href=https://www.w3.org/TR/navigation-timing-2/#sec-performance-navigation-types rel=noopener>navigation type</a>: <code>navigate</code>, <code>reload</code>, <code>back_forward</code>, or <code>prerender</code>. This will allow you to continue to monitor your performance within these navigation types—even if the overall distribution skews negative. This approach is recommended for non-user-centric page load metrics like <a href=/ttfb/>Time to First Byte (TTFB)</a>.</p><p>For user-centric metrics like the <a href=/vitals/>Core Web Vitals</a>, a better option is to report a value that more accurately represents what the user experiences.</p><aside class="aside flow bg-state-bad-bg color-state-bad-text"><p class="cluster color-state-bad-text"><span class="aside__icon box-block"><svg aria-label="Error sign" viewbox="0 0 24 24" fill=currentColor height=24 role=img width=24 xmlns=http://www.w3.org/2000/svg><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-2h2v2h-2zm0-10v6h2V7h-2z" clip-rule=evenodd fill-rule=evenodd /></svg></span><strong>Caution</strong></p><div class=flow>The <code>back_forward</code> navigation type in the <a href=https://www.w3.org/TR/navigation-timing-2/#sec-performance-navigation-types>Navigation Timing API</a> is not to be confused with bfcache restores. The Navigation Timing API only annotates page loads, whereas bfcache restores are re-using a page loaded from a previous navigation.</div></aside><h3 id=impact-on-core-web-vitals>Impact on Core Web Vitals <a class=headline-link href=#impact-on-core-web-vitals>#</a></h3><p><a href=/vitals/>Core Web Vitals</a> measure the user's experience of a web page across a variety of dimensions (loading speed, interactivity, visual stability), and since users experience bfcache restores as faster navigations than traditional page loads, it's important that the Core Web Vitals metrics reflect this. After all, a user doesn't care whether or not bfcache was enabled, they just care that the navigation was fast!</p><p>Tools like the <a href=https://developer.chrome.com/docs/crux/ rel=noopener>Chrome User Experience Report</a>, that collect and report on the Core Web Vitals metrics treat bfcache restores as separate page visits in their dataset.</p><p>And while there aren't (yet) dedicated web performance APIs for measuring these metrics after bfcache restores, their values can be approximated using existing web APIs.</p><ul><li>For <a href=/lcp/>Largest Contentful Paint (LCP)</a>, you can use the delta between the <code>pageshow</code> event's timestamp and the timestamp of the next painted frame (since all elements in the frame will be painted at the same time). Note that in the case of a bfcache restore, LCP and FCP will be the same.</li><li>For <a href=/fid/>First Input Delay (FID)</a>, you can re-add the event listeners (the same ones used by the <a href=https://github.com/GoogleChromeLabs/first-input-delay rel=noopener>FID polyfill</a>) in the <code>pageshow</code> event, and report FID as the delay of the first input after the bfcache restore.</li><li>For <a href=/cls/>Cumulative Layout Shift (CLS)</a>, you can continue to keep using your existing Performance Observer; all you have to do is reset the current CLS value to 0.</li></ul><p>For more details on how bfcache affects each metric, refer to the individual Core Web Vitals <a href=/vitals/#core-web-vitals>metric guides pages</a>. And for a specific example of how to implement bfcache versions of these metrics in code, refer to the <a href=https://github.com/GoogleChrome/web-vitals/pull/87 rel=noopener>PR adding them to the web-vitals JS library</a>.</p><aside class="aside flow bg-state-info-bg color-state-info-text"><div class=flow>As of <code>v1</code>, the <a href=https://github.com/GoogleChrome/web-vitals>web-vitals</a> JavaScript library <a href=https://github.com/GoogleChrome/web-vitals/pull/87>supports bfcache restores</a> in the metrics it reports. Developers using <code>v1</code> or greater should not need to update their code.</div></aside><h2 id=additional-resources>Additional Resources <a class=headline-link href=#additional-resources>#</a></h2><ul><li><a href=https://developer.mozilla.org/Firefox/Releases/1.5/Using_Firefox_1.5_caching rel=noopener>Firefox Caching</a> <em>(bfcache in Firefox)</em></li><li><a href=https://webkit.org/blog/427/webkit-page-cache-i-the-basics/ rel=noopener>Page Cache</a> <em>(bfcache in Safari)</em></li><li><a href="https://docs.google.com/document/d/1JtDCN9A_1UBlDuwkjn1HWxdhQ1H2un9K4kyPLgBqJUc/edit?usp=sharing" rel=noopener>Back/forward cache: web exposed behavior</a> <em>(bfcache differences across browsers)</em></li><li><a href="https://back-forward-cache-tester.glitch.me/?persistent_logs=1" rel=noopener>bfcache tester</a> <em>(test how different APIs and events affect bfcache in browsers)</em></li><li><a href=https://www.smashingmagazine.com/2022/05/performance-game-changer-back-forward-cache/ rel=noopener>Performance Game Changer: Browser Back/Forward Cache</a> <em>(a case study from Smashing Magazine showing dramatic Core Web Vitals improvements by enabling bfcache)</em></li></ul><nav class="cluster gutter-base flow-space-size-2" aria-label=tags><a class=pill href=/tags/performance/>Performance</a><a class=pill href=/tags/web-vitals/>Web Vitals</a></nav><div class=post-credits><div><h3>Last updated</h3><span> <time>May 25, 2023</time> </span> — <a href=https://github.com/GoogleChrome/web.dev/blob/main/src/site/content/en/blog/bfcache/index.md> Improve article </a></div></div><div class=flow-space-size-2><a class=button data-type=secondary href=/blog> <svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0z" fill=none /><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg> <span>Return to all articles</span> </a></div><div class="docked-actions flow flow-space-base"><div><share-action authors="@philwalton | @tunetheweb" class="gc-analytics-event fab" data-action=click data-category=web.dev data-icon=share data-label=share data-type=primary role=button tabindex=0> <svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M0 0h24v24H0V0z" fill=none /><path d="M18 16.1c-.8 0-1.4.3-2 .8l-7.1-4.2c.1-.2.1-.5.1-.7s0-.5-.1-.7L16 7.2c.5.5 1.2.8 2 .8 1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3c0 .2 0 .5.1.7L8 9.8C7.5 9.3 6.8 9 6 9c-1.7 0-3 1.3-3 3s1.3 3 3 3c.8 0 1.5-.3 2-.8l7.1 4.2c-.1.2-.1.4-.1.6 0 1.6 1.3 2.9 2.9 2.9s2.9-1.3 2.9-2.9-1.2-2.9-2.8-2.9z" fill=currentColor /></svg> <span class=fab__label>Share</span> </share-action></div><div><a class="fab gc-analytics-event" data-action=click data-category=web.dev data-label=view-subscribe data-type=primary href=/newsletter/> <svg aria-label="An envelope with plus icon" viewbox="0 0 24 24" height=24 role=img width=24 xmlns=http://www.w3.org/2000/svg><path d="M13 20H4c-1.1 0-2-.9-2-2l.01-12c0-1.1.89-2 1.99-2h16c1.1 0 2 .9 2 2v7h-2V8l-8 5-8-5v10h9v2zm-1-9l8-5H4l8 5zm8 7h3v2h-3v3h-2v-3h-3v-2h3v-3h2v3z" fill=currentColor fill-rule=nonzero /></svg> <span class=fab__label>subscribe</span> </a></div></div></article></div></div></main><footer class=site-footer role=contentinfo><nav aria-label="footer navigation" class="site-footer__primary-nav auto-grid"><div class=site-footer__primary-nav-content><a class="site-footer__brand brand" href=/> <svg viewbox="0 0 125 24" aria-label=web.dev fill=currentColor height=24 role=img width=125 xmlns=http://www.w3.org/2000/svg><path d="M0.625 19.9489C0.625 18.2638 1.99102 16.8977 3.67614 16.8977H19.9489C21.634 16.8977 23 18.2638 23 19.9489C23 21.634 21.634 23 19.9489 23H3.67614C1.99102 23 0.625 21.634 0.625 19.9489Z" fill=#66CCFF /><path d="M1.51866 1.51866C2.7102 0.327114 4.64208 0.327114 5.83361 1.51866L13.97 9.65503C15.1615 10.8466 15.1615 12.7784 13.97 13.97L5.83361 22.1063C4.64208 23.2979 2.7102 23.2979 1.51866 22.1063C0.327114 20.9148 0.327114 18.9829 1.51866 17.7914L7.13797 12.1721C7.33655 11.9735 7.33655 11.6515 7.13797 11.4529L1.51866 5.83361C0.327114 4.64208 0.327114 2.7102 1.51866 1.51866Z" clip-rule=evenodd fill=#0066FF fill-rule=evenodd /><path d="M11.0422 16.8977L5.83361 22.1063C4.64208 23.2979 2.7102 23.2979 1.51866 22.1063C0.327114 20.9148 0.327114 18.9829 1.51866 17.7914L2.41233 16.8977H11.0422Z" fill=#CC66FF /><path d="M19.9488 23C21.6339 23 23 21.634 23 19.9489C23 18.2638 21.6339 16.8977 19.9488 16.8977C18.2637 16.8977 16.8977 18.2638 16.8977 19.9489C16.8977 21.634 18.2637 23 19.9488 23Z" fill=#0066FF /><path d="M116.6 20.1H114.4L109.6 8.20005H112L115.5 17.4L119 8.20005H121.4L116.6 20.1V20.1ZM99.8 12.8H106.6C106.5 11.2 105.2 9.90005 103.2 9.90005C101.5 9.90005 100.2 11 99.8 12.8V12.8ZM103.4 20.5C99.9 20.5 97.4 17.8 97.4 14.2C97.4 10.6 99.9 7.90005 103.3 7.90005C106.8 7.90005 109.1 10.3 109.1 14.4V14.6H99.8C99.9 16.9 101.6 18.5 103.6 18.5C105 18.5 106.2 17.8 106.9 16.4L108.9 17.4C107.8 19.3 105.8 20.5 103.4 20.5V20.5ZM89.4 20.5C86.3 20.5 83.7 17.7 83.7 14.2C83.7 10.7 86.3 7.90005 89.4 7.90005C91.1 7.90005 92.7 8.70005 93.5 9.90005H93.6L93.5 8.30005V2.80005H95.7V20.1H93.6V18.5H93.5C92.6 19.7 91.1 20.5 89.4 20.5V20.5ZM89.7 18.5C91.9 18.5 93.5 16.8 93.5 14.2C93.5 11.7 91.9 9.90005 89.7 9.90005C87.6 9.90005 85.9 11.7 85.9 14.2C85.9 16.7 87.6 18.5 89.7 18.5ZM82.9 18.6C82.9 19.5 82.2 20.2001 81.2 20.2001C80.3 20.2001 79.5 19.4 79.5 18.6C79.5 17.7 80.3 17 81.2 17C82.2 17 82.9 17.7 82.9 18.6ZM72.4 18.5C74.5 18.5 76.2 16.7 76.2 14.2C76.2 11.7 74.5 9.90005 72.4 9.90005C70.2 9.90005 68.6 11.7 68.6 14.2C68.6 16.7 70.2 18.5 72.4 18.5ZM72.8 20.5C71.1 20.5 69.5 19.7 68.7 18.5H68.6V20.1H66.5V2.80005H68.7V8.30005L68.6 9.90005H68.7C69.5 8.70005 71 7.90005 72.8 7.90005C75.9 7.90005 78.5 10.7 78.5 14.2C78.4 17.7 75.9 20.5 72.8 20.5V20.5ZM55.4 12.8H62.2C62.1 11.2 60.8 9.90005 58.8 9.90005C57.1 9.90005 55.8 11 55.4 12.8V12.8ZM59 20.5C55.5 20.5 53 17.8 53 14.2C53 10.6 55.5 7.90005 58.9 7.90005C62.4 7.90005 64.7 10.3 64.7 14.4V14.6H55.4C55.5 16.9 57.2 18.5 59.2 18.5C60.6 18.5 61.7 17.8 62.5 16.4L64.5 17.4C63.4 19.3 61.4 20.5 59 20.5V20.5ZM52.7 8.30005L48.9 20.2001H46.6L43.6 11.1L40.7 20.2001H38.4L34.5 8.30005H36.8L39.4 17.3L42.3 8.30005H44.6L47.5 17.3L50.1 8.30005H52.7V8.30005Z" clip-rule=evenodd fill-rule=evenodd /></svg> </a><p class=text-size-0>We want to help you build beautiful, accessible, fast, and secure websites that work cross-browser, and for all of your users. This site is our home for content to help you on that journey, written by members of the Chrome team, and external experts.</p></div><div class="site-footer__primary-nav-links auto-grid"><div><h3 class="text-size-2 color-mid-text">Contribute</h3><ul class=site-footer__linkbox-list role=list><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)" href="https://github.com/GoogleChrome/web.dev/issues/new?assignees=&labels=bug&template=bug_report.md&title="> File a bug </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)" href=https://github.com/googlechrome/web.dev> View source </a></li></ul></div><div><h3 class="text-size-2 color-mid-text">Related content</h3><ul class=site-footer__linkbox-list role=list><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)" href=https://developer.chrome.com/> developer.chrome.com </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)" href=https://blog.chromium.org/> Chrome updates </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)" href=/tags/case-study/> Case studies </a></li><li><a data-label="Footer Link (index 5)" data-category=Podcasts href=/podcasts/> Podcasts </a></li><li><a data-label="Footer Link (index 6)" data-category=Shows href=/shows/> Shows </a></li></ul></div><div><h3 class="text-size-2 color-mid-text">Connect</h3><ul class=site-footer__linkbox-list role=list><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)" href=https://www.twitter.com/ChromiumDev> Twitter </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)" href=https://www.youtube.com/user/ChromeDevelopers> YouTube </a></li></ul></div></div></nav><nav aria-label="Google developers" class="site-footer__brand-nav repel"><ul class=cluster role=list><li><a data-category="Site-Wide Custom Events" data-label="Footer Google Developers Link" href=https://developers.google.com/> <img alt="Google Developers" class=site-footer__utility-logo height=33 loading=lazy src=/images/lockup-color.png width=185> </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Chrome Link" href=https://developer.chrome.com/> Chrome </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Firebase Link" href=https://firebase.google.com/> Firebase </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Google Cloud Platform Link" href=https://cloud.google.com/> Google Cloud Platform </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer All products Link" href=https://developers.google.com/products> All products </a></li></ul><div class=cluster><theme-toggle> <label class=toggle-switch for=theme-toggle><span class=toggle-switch__label>Dark theme</span> <input class=toggle-switch__input id=theme-toggle role=switch type=checkbox> <div class="toggle-switch__decor focus-ring" aria-hidden=true><div class=toggle-switch__thumb></div></div></label> </theme-toggle><web-language-select current=en></web-language-select></div></nav><nav aria-label="terms and policies" class=site-footer__misc-links><ul class=cluster role=list><li><a data-category="Site-Wide Custom Events" data-label="Footer Terms and Privacy link" href=https://policies.google.com/> Terms & Privacy </a></li><li><a data-category="Site-Wide Custom Events" data-label="Footer Community Guidelines link" href=/community-guidelines/> Community Guidelines </a></li></ul></nav><p class="gap-top-size-2 text-size-0">Except as otherwise noted, the content of this page is licensed under the <a href=https://creativecommons.org/licenses/by/4.0/> Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href=https://www.apache.org/licenses/LICENSE-2.0> Apache 2.0 License</a>. For details, see the <a href=https://developers.google.com/terms/site-policies> Google Developers Site Policies</a>.</p></footer><web-devrel-ribbon class=devrel-ribbon> <a class="devrel-ribbon__ribbon bg-floating-ribbon-bg" href=/about/> <span>By</span> <svg viewbox="0 0 24 24" fill=none height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M12.0002 0.000198896C8.03654 0.000198896 4.52717 1.9163 2.34307 4.87283L6.04945 11.2927C6.22181 9.848 6.91291 8.51514 7.99463 7.54208C9.07636 6.56901 10.4747 6.0223 11.9296 6.00331C11.9529 6.00073 11.9767 5.99962 12.0005 5.99981L22.3939 5.99981C20.3207 2.41237 16.4471 0.000198896 12.0002 0.000198896ZM1.60671 5.99906C0.586498 7.76412 0 9.81226 0 12.0003C0 18.1811 4.65658 23.2593 10.6575 23.9249L14.3581 17.5155C13.6129 17.8346 12.8109 17.9998 12.0001 18.0003C9.89088 17.9976 7.93796 16.8875 6.85643 15.0765C6.83691 15.0526 6.81923 15.027 6.80376 15.0003L1.60671 5.99906ZM12.0002 7.20025C10.7271 7.20025 9.50625 7.70609 8.60612 8.60622C7.70598 9.50636 7.20033 10.7273 7.20033 12.0003C7.20033 13.2733 7.70603 14.4942 8.60612 15.3943C9.50621 16.2945 10.7271 16.8001 12.0002 16.8001C13.2732 16.8001 14.4941 16.2944 15.3942 15.3943C16.2944 14.4943 16.8 13.2733 16.8 12.0003C16.8 10.7273 16.2943 9.50636 15.3942 8.60622C14.4941 7.70609 13.2732 7.20025 12.0002 7.20025ZM15.5902 7.20025C17.1048 8.33129 17.9977 10.11 18.0001 12.0003C17.9977 13.0181 17.7364 14.0185 17.2409 14.9076C17.2289 14.9397 17.2142 14.9706 17.1969 15.0003L12.0009 24.0002C18.6352 23.9998 24 18.6345 24 12.0001C24 10.2923 23.6427 8.66976 23.0015 7.2001L15.5902 7.20025Z" fill=white /></svg> <span>Chrome DevRel</span> </a> </web-devrel-ribbon></body></html>